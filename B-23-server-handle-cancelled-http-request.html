<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>B.23. Golang Server Handler untuk Cancelled Client HTTP Request - Dasar Pemrograman Golang</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="gitbook/style.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="styles/website.css"rel="stylesheet"><meta content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"name="google-site-verification"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="og:image"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="twitter:image"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="B-22-configuration-file.html"rel="prev"/></head><body><div class="book"><div class="book-summary"><div role="search"id="book-search-input"><input placeholder="Type to search"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="./"><a href="./">Introduction</a></li><li class="chapter"data-level="1.2"><span>A. Pemrograman Go Dasar</span><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="1-berkenalan-dengan-golang.html"><a href="1-berkenalan-dengan-golang.html">A.1. Berkenalan Dengan Golang</a></li><li class="chapter"data-level="1.2.2"data-path="2-instalasi-golang.html"><a href="2-instalasi-golang.html">A.2. Instalasi Golang</a></li><li class="chapter"data-level="1.2.3"data-path="3-gopath-dan-workspace.html"><a href="3-gopath-dan-workspace.html">A.3. GOPATH Dan Workspace</a></li><li class="chapter"data-level="1.2.4"data-path="4-instalasi-editor.html"><a href="4-instalasi-editor.html">A.4. Instalasi Editor</a></li><li class="chapter"data-level="1.2.5"data-path="5-go-command.html"><a href="5-go-command.html">A.5. Command</a></li><li class="chapter"data-level="1.2.6"data-path="6-hello-world.html"><a href="6-hello-world.html">A.6. Program Pertama: Hello World</a></li><li class="chapter"data-level="1.2.7"data-path="7-komentar.html"><a href="7-komentar.html">A.7. Komentar</a></li><li class="chapter"data-level="1.2.8"data-path="8-variabel.html"><a href="8-variabel.html">A.8. Variabel</a></li><li class="chapter"data-level="1.2.9"data-path="9-tipe-data.html"><a href="9-tipe-data.html">A.9. Tipe Data</a></li><li class="chapter"data-level="1.2.10"data-path="10-konstanta.html"><a href="10-konstanta.html">A.10. Konstanta</a></li><li class="chapter"data-level="1.2.11"data-path="11-operator.html"><a href="11-operator.html">A.11. Operator</a></li><li class="chapter"data-level="1.2.12"data-path="12-seleksi-kondisi.html"><a href="12-seleksi-kondisi.html">A.12. Seleksi Kondisi</a></li><li class="chapter"data-level="1.2.13"data-path="13-perulangan.html"><a href="13-perulangan.html">A.13. Perulangan</a></li><li class="chapter"data-level="1.2.14"data-path="14-array.html"><a href="14-array.html">A.14. Array</a></li><li class="chapter"data-level="1.2.15"data-path="15-slice.html"><a href="15-slice.html">A.15. Slice</a></li><li class="chapter"data-level="1.2.16"data-path="16-map.html"><a href="16-map.html">A.16. Map</a></li><li class="chapter"data-level="1.2.17"data-path="17-fungsi.html"><a href="17-fungsi.html">A.17. Fungsi</a></li><li class="chapter"data-level="1.2.18"data-path="18-fungsi-multiple-return.html"><a href="18-fungsi-multiple-return.html">A.18. Fungsi Multiple Return</a></li><li class="chapter"data-level="1.2.19"data-path="19-fungsi-variadic.html"><a href="19-fungsi-variadic.html">A.19. Fungsi Variadic</a></li><li class="chapter"data-level="1.2.20"data-path="20-fungsi-closure.html"><a href="20-fungsi-closure.html">A.20. Fungsi Closure</a></li><li class="chapter"data-level="1.2.21"data-path="21-fungsi-sebagai-parameter.html"><a href="21-fungsi-sebagai-parameter.html">A.21. Fungsi Sebagai parameter</a></li><li class="chapter"data-level="1.2.22"data-path="22-pointer.html"><a href="22-pointer.html">A.22. Pointer</a></li><li class="chapter"data-level="1.2.23"data-path="23-struct.html"><a href="23-struct.html">A.23. Struct</a></li><li class="chapter"data-level="1.2.24"data-path="24-method.html"><a href="24-method.html">A.24. Method</a></li><li class="chapter"data-level="1.2.25"data-path="25-properti-public-dan-private.html"><a href="25-properti-public-dan-private.html">A.25. Property Public & Private</a></li><li class="chapter"data-level="1.2.26"data-path="26-interface.html"><a href="26-interface.html">A.26. Interface</a></li><li class="chapter"data-level="1.2.27"data-path="27-interface-kosong.html"><a href="27-interface-kosong.html">A.27. Interface Kosong</a></li><li class="chapter"data-level="1.2.28"data-path="28-reflect.html"><a href="28-reflect.html">A.28. Reflect</a></li><li class="chapter"data-level="1.2.29"data-path="29-goroutine.html"><a href="29-goroutine.html">A.29. Goroutine</a></li><li class="chapter"data-level="1.2.30"data-path="30-channel.html"><a href="30-channel.html">A.30. Channel</a></li><li class="chapter"data-level="1.2.31"data-path="31-buffered-channel.html"><a href="31-buffered-channel.html">A.31. Buffered Channel</a></li><li class="chapter"data-level="1.2.32"data-path="32-channel-select.html"><a href="32-channel-select.html">A.32. Channel - Select</a></li><li class="chapter"data-level="1.2.33"data-path="33-channel-range-close.html"><a href="33-channel-range-close.html">A.33. Channel - Range & Close</a></li><li class="chapter"data-level="1.2.34"data-path="34-channel-timeout.html"><a href="34-channel-timeout.html">A.34. Channel - Timeout</a></li><li class="chapter"data-level="1.2.35"data-path="35-defer-exit.html"><a href="35-defer-exit.html">A.35. Defer & Exit</a></li><li class="chapter"data-level="1.2.36"data-path="36-error-panic-recover.html"><a href="36-error-panic-recover.html">A.36. Error, Panic, & Recover</a></li><li class="chapter"data-level="1.2.37"data-path="37-string-format.html"><a href="37-string-format.html">A.37. Layout Format String</a></li><li class="chapter"data-level="1.2.38"data-path="38-time.html"><a href="38-time.html">A.38. Time, Parsing Time, & Format Time</a></li><li class="chapter"data-level="1.2.39"data-path="39-timer.html"><a href="39-timer.html">A.39. Timer, Ticker, & Scheduler</a></li><li class="chapter"data-level="1.2.40"data-path="40-data-type-conversion.html"><a href="40-data-type-conversion.html">A.40. Konversi Antar Tipe Data</a></li><li class="chapter"data-level="1.2.41"data-path="41-strings.html"><a href="41-strings.html">A.41. Fungsi String</a></li><li class="chapter"data-level="1.2.42"data-path="42-regex.html"><a href="42-regex.html">A.42. Regex</a></li><li class="chapter"data-level="1.2.43"data-path="43-encoding-base64.html"><a href="43-encoding-base64.html">A.43. Encode - Decode Base64</a></li><li class="chapter"data-level="1.2.44"data-path="44-hash-sha1.html"><a href="44-hash-sha1.html">A.44. Hash Sha1</a></li><li class="chapter"data-level="1.2.45"data-path="45-command-line-args-flag.html"><a href="45-command-line-args-flag.html">A.45. Arguments & Flag</a></li><li class="chapter"data-level="1.2.46"data-path="46-exec.html"><a href="46-exec.html">A.46. Exec</a></li><li class="chapter"data-level="1.2.47"data-path="47-file.html"><a href="47-file.html">A.47. File</a></li><li class="chapter"data-level="1.2.48"data-path="48-web.html"><a href="48-web.html">A.48. Web</a></li><li class="chapter"data-level="1.2.49"data-path="49-url-parsing.html"><a href="49-url-parsing.html">A.49. URL Parsing</a></li><li class="chapter"data-level="1.2.50"data-path="50-json.html"><a href="50-json.html">A.50. JSON</a></li><li class="chapter"data-level="1.2.51"data-path="51-web-json-api.html"><a href="51-web-json-api.html">A.51. Web Service API (JSON Data)</a></li><li class="chapter"data-level="1.2.52"data-path="52-http-request.html"><a href="52-http-request.html">A.52. HTTP Request</a></li><li class="chapter"data-level="1.2.53"data-path="53-sql.html"><a href="53-sql.html">A.53. SQL</a></li><li class="chapter"data-level="1.2.54"data-path="54-mongodb.html"><a href="54-mongodb.html">A.54. NoSQL MongoDB</a></li><li class="chapter"data-level="1.2.55"data-path="55-unit-test.html"><a href="55-unit-test.html">A.55. Unit Test</a></li><li class="chapter"data-level="1.2.56"data-path="56-waitgroup.html"><a href="56-waitgroup.html">A.56. WaitGroup</a></li><li class="chapter"data-level="1.2.57"data-path="57-mutex.html"><a href="57-mutex.html">A.57. Mutex</a></li><li class="chapter"data-level="1.2.58"data-path="A-58-go-vendoring.html"><a href="A-58-go-vendoring.html">A.58. Go Vendoring</a></li><li class="chapter"data-level="1.2.59"data-path="A-59-go-dep.html"><a href="A-59-go-dep.html">A.59. Dep - Go Dependency Management Tool</a></li><li class="chapter"data-level="1.2.60"data-path="A-60-go-modules.html"><a href="A-60-go-modules.html">A.60. Go Modules</a></li></ul></li><li class="chapter"data-level="1.3"><span>B. Pemrograman Web Go Dasar</span><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="B-1-golang-web-hello-world.html"><a href="B-1-golang-web-hello-world.html">B.1. Golang Web App: Hello World</a></li><li class="chapter"data-level="1.3.2"data-path="B-2-routing-http-handlefunc.html"><a href="B-2-routing-http-handlefunc.html">B.2. Routing http.HandleFunc</a></li><li class="chapter"data-level="1.3.3"data-path="B-3-routing-static-assets.html"><a href="B-3-routing-static-assets.html">B.3. Routing Static Assets</a></li><li class="chapter"data-level="1.3.4"data-path="B-4-template-render-html.html"><a href="B-4-template-render-html.html">B.4. Template: Render HTML Template</a></li><li class="chapter"data-level="1.3.5"data-path="B-5-template-render-partial-html.html"><a href="B-5-template-render-partial-html.html">B.5. Template: Render Partial HTML Template</a></li><li class="chapter"data-level="1.3.6"data-path="B-6-template-actions-variables.html"><a href="B-6-template-actions-variables.html">B.6. Template: Actions & Variables</a></li><li class="chapter"data-level="1.3.7"data-path="B-7-template-functions.html"><a href="B-7-template-functions.html">B.7. Template: Functions</a></li><li class="chapter"data-level="1.3.8"data-path="B-8-template-custom-functions.html"><a href="B-8-template-custom-functions.html">B.8. Template: Custom Functions</a></li><li class="chapter"data-level="1.3.9"data-path="B-9-render-specific-html-template.html"><a href="B-9-render-specific-html-template.html">B.9. Template: Render Specific HTML Template</a></li><li class="chapter"data-level="1.3.10"data-path="B-10-render-html-string.html"><a href="B-10-render-html-string.html">B.10. Template: Render HTML String</a></li><li class="chapter"data-level="1.3.11"data-path="B-11-http-method.html"><a href="B-11-http-method.html">B.11. HTTP Method: POST & GET</a></li><li class="chapter"data-level="1.3.12"data-path="B-12-form-value.html"><a href="B-12-form-value.html">B.12. Form Value</a></li><li class="chapter"data-level="1.3.13"data-path="B-13-form-upload-file.html"><a href="B-13-form-upload-file.html">B.13. Form Upload File</a></li><li class="chapter"data-level="1.3.14"data-path="B-14-ajax-json-payload.html"><a href="B-14-ajax-json-payload.html">B.14. AJAX JSON Payload</a></li><li class="chapter"data-level="1.3.15"data-path="B-15-ajax-json-response.html"><a href="B-15-ajax-json-response.html">B.15. AJAX JSON Response</a></li><li class="chapter"data-level="1.3.16"data-path="B-16-ajax-multi-upload.html"><a href="B-16-ajax-multi-upload.html">B.16. AJAX Multiple File Upload</a></li><li class="chapter"data-level="1.3.17"data-path="B-17-download-file.html"><a href="B-17-download-file.html">B.17. Download File</a></li><li class="chapter"data-level="1.3.18"data-path="B-18-http-basic-auth.html"><a href="B-18-http-basic-auth.html">B.18. HTTP Basic Auth</a></li><li class="chapter"data-level="1.3.19"data-path="B-19-middleware-using-http-handler.html"><a href="B-19-middleware-using-http-handler.html">B.19. Middleware http.Handler</a></li><li class="chapter"data-level="1.3.20"data-path="B-20-custom-mux-multiplexer.html"><a href="B-20-custom-mux-multiplexer.html">B.20. Custom Multiplexer</a></li><li class="chapter"data-level="1.3.21"data-path="B-21-cookie.html"><a href="B-21-cookie.html">B.21. HTTP Cookie</a></li><li class="chapter"data-level="1.3.22"data-path="B-22-configuration-file.html"><a href="B-22-configuration-file.html">B.22. Configuration File</a></li><li class="chapter active"data-level="1.3.23"data-path="B-23-server-handle-cancelled-http-request.html"><a href="B-23-server-handle-cancelled-http-request.html">B.23. Server Handler untuk Cancelled Client HTTP Request</a></li></ul></li><li class="chapter"data-level="1.4"><span>C. Pemrograman Go Lanjut</span><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="C-1-echo-routing.html"><a href="C-1-echo-routing.html">C.1. Echo Framework & Routing</a></li><li class="chapter"data-level="1.4.2"data-path="C-2-parsing-http-request-payload-echo.html"><a href="C-2-parsing-http-request-payload-echo.html">C.2. Parsing HTTP Request Payload (Echo)</a></li><li class="chapter"data-level="1.4.3"data-path="C-3-http-request-payload-validation.html"><a href="C-3-http-request-payload-validation.html">C.3. HTTP Request Payload Validation (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.4"data-path="C-4-http-error-handling.html"><a href="C-4-http-error-handling.html">C.4. HTTP Error Handling (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.5"data-path="C-5-echo-template-rendering.html"><a href="C-5-echo-template-rendering.html">C.5. Template Rendering in Echo</a></li><li class="chapter"data-level="1.4.6"data-path="C-6-advanced-middleware-and-logging.html"><a href="C-6-advanced-middleware-and-logging.html">C.6. Advanced Middleware & Logging (Logrus, Echo Logger)</a></li><li class="chapter"data-level="1.4.7"data-path="C-7-flag-parser.html"><a href="C-7-flag-parser.html">C.7. CLI Flag Parser (Kingpin)</a></li><li class="chapter"data-level="1.4.8"data-path="C-8-advanced-configuration-file.html"><a href="C-8-advanced-configuration-file.html">C.8. Advanced Configuration File (Viper)</a></li><li class="chapter"data-level="1.4.9"data-path="C-9-securecookie.html"><a href="C-9-securecookie.html">C.9. Secure Cookie (Gorilla Securecookie)</a></li><li class="chapter"data-level="1.4.10"data-path="C-10-session.html"><a href="C-10-session.html">C.10. Session (Gorilla Session)</a></li><li class="chapter"data-level="1.4.11"data-path="C-12-cors-preflight-request.html"><a href="C-12-cors-preflight-request.html">C.12. CORS & Preflight Request</a></li><li class="chapter"data-level="1.4.12"data-path="C-13-csrf.html"><a href="C-13-csrf.html">C.13. CSRF</a></li><li class="chapter"data-level="1.4.13"data-path="C-14-secure-middleware.html"><a href="C-14-secure-middleware.html">C.14. Secure Middleware</a></li><li class="chapter"data-level="1.4.14"data-path="C-15-http-gzip-compression.html"><a href="C-15-http-gzip-compression.html">C.15. HTTP Gzip Compression (gziphandler)</a></li><li class="chapter"data-level="1.4.15"data-path="C-16-send-email.html"><a href="C-16-send-email.html">C.16. Send Mail (net/smtp, Gomail v2)</a></li><li class="chapter"data-level="1.4.16"data-path="C-17-read-write-excel-xlsx-file.html"><a href="C-17-read-write-excel-xlsx-file.html">C.17. Read & Write Excel XLSX File (Excelize)</a></li><li class="chapter"data-level="1.4.17"data-path="C-18-write-pdf-file.html"><a href="C-18-write-pdf-file.html">C.18. Write PDF File (gofpdf)</a></li><li class="chapter"data-level="1.4.18"data-path="C-19-convert-html-to-pdf.html"><a href="C-19-convert-html-to-pdf.html">C.19. Convert HTML to PDF (go-wkhtmltopdf)</a></li><li class="chapter"data-level="1.4.19"data-path="C-20-scraping-parsing-html.html"><a href="C-20-scraping-parsing-html.html">C.20. Scraping & Parsing HTML (goquery)</a></li><li class="chapter"data-level="1.4.20"data-path="C-21-xml-parser.html"><a href="C-21-xml-parser.html">C.21. Parse & Generate XML (etree)</a></li><li class="chapter"data-level="1.4.21"data-path="C-22-https-tls.html"><a href="C-22-https-tls.html">C.22. HTTPS/TLS Web Server</a></li><li class="chapter"data-level="1.4.22"data-path="C-23-http2-server-push.html"><a href="C-23-http2-server-push.html">C.23. HTTP/2 & HTTP/2 Server Push</a></li><li class="chapter"data-level="1.4.23"data-path="C-24-client-http-request.html"><a href="C-24-client-http-request.html">C.24. Client HTTP Request</a></li><li class="chapter"data-level="1.4.24"data-path="C-25-secure-insecure-client-http-request.html"><a href="C-25-secure-insecure-client-http-request.html">C.25. Secure & Insecure Client HTTP Request</a></li><li class="chapter"data-level="1.4.25"data-path="C-26-golang-ftp.html"><a href="C-26-golang-ftp.html">C.26. FTP</a></li><li class="chapter"data-level="1.4.26"data-path="C-27-golang-ssh-sftp.html"><a href="C-27-golang-ssh-sftp.html">C.27. SSH & SFTP</a></li><li class="chapter"data-level="1.4.27"data-path="C-28-golang-web-socket.html"><a href="C-28-golang-web-socket.html">C.28. Web Socket: Chatting App</a></li><li class="chapter"data-level="1.4.28"data-path="C-29-golang-protobuf-implementation.html"><a href="C-29-golang-protobuf-implementation.html">C.29. Protobuf</a></li><li class="chapter"data-level="1.4.29"data-path="C-30-golang-grpc-protobuf.html"><a href="C-30-golang-grpc-protobuf.html">C.30. gRPC + Protobuf</a></li><li class="chapter"data-level="1.4.30"data-path="C-31-golang-context.html"><a href="C-31-golang-context.html">C.31. Context: Value, Timeout, & Cancellation</a></li><li class="chapter"data-level="1.4.31"data-path="C-32-golang-jwt.html"><a href="C-32-golang-jwt.html">C.32. JSON Web Token (JWT)</a></li><li class="chapter"data-level="1.4.32"data-path="C-33-golang-ldap-authentication.html"><a href="C-33-golang-ldap-authentication.html">C.33. LDAP Authentication</a></li></ul></li><li><a href="https://www.gitbook.com"target="blank"class="gitbook-link">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><a href=".">B.23. Server Handler untuk Cancelled Client HTTP Request</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="b23-server-handler-untuk-cancelled-client-http-request">B.23. Server Handler untuk Cancelled Client HTTP Request</h1><p>Dalam konteks web application, kadang kala sebuah http request butuh waktu cukup lama untuk selesai, bisa jadi karena kode yang kurang dioptimasi, atau proses nya lama, atau mungkin faktor lainnya. Dari sisi client, biasanya ada handler untuk cancel request jika melebihi batas timeout yang sudah didefinisikan, dan ketika itu terjadi di client akan sangat mudah untuk antisipasinya.</p><p>Berbeda dengan handler di back end-nya, by default request yang sudah di-cancel oleh client tidak terdeteksi (proses di back end akan tetap lanjut). Umumnya tidak ada masalah mengenai ini, tapi ada kalanya kita perlu men-treat cancelled request dengan baik untuk keperluan lain (logging, atau lainnya).</p><p>Pada bab ini kita akan belajar caranya.</p><h2 id="b321-praktek">B.32.1. Praktek</h2><p>Dari objek <code>*http.Request</code> bisa diambil objek context lewat method <code>.Context()</code>, dan dari context tersebut kita bisa mendeteksi apakah sebuah request di-cancel atau tidak oleh client.</p><blockquote><p>Pada bab ini kita tidak membahas secara rinci apa itu context. Silakan langsung merujuk ke <a href="https://dasarpemrogramangolang.novalagung.com/C-31-golang-context.html"target="_blank">Bab C.31. Context: Value, Timeout, &amp; Cancellation</a> untuk lebih detailnya.</p></blockquote><p>Object context memiliki method <code>.Done()</code> yang nilai baliknya berupa channel. Dari channel tersebut kita bisa deteksi apakah request di-cancel atau tidak, caranya dengan cara mengecek apakah ada data yang terkirim lewat channel tersebut, jika ada maka lakukan pengecekan pada error message-nya, jika ada keterangan <code>&quot;cancelled&quot;</code> maka diasumsikan request tersebut dibatalkan.</p><p>Mari kita praktekan langsung. Siapkan base kode sederhana berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;net/http&quot;</span>
    <span class="hljs-string">&quot;strings&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">func</span> handleIndex(w http.ResponseWriter, r *http.Request) {
    <span class="hljs-comment">// do something here</span>
}

<span class="hljs-keyword">func</span> main() {
    http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, handleIndex)
    http.ListenAndServe(<span class="hljs-string">&quot;:8080&quot;</span>, <span class="hljs-literal">nil</span>)
}
</code></pre><p>Di dalam <code>handleIndex()</code> disimulasikan sebuah proses membutuhkan waktu lama untuk selesai (kita gunakan <code>time.Sleep()</code> untuk ini). Umumnya kode akan dituliskan langsung dalam handler tersebut, tapi pada kasus ini tidak. Untuk bisa mendeteksi sebuah request di-cancel atau tidak, harus di-dispatch sebuah goroutine baru.</p><ul><li>Cara ke-1: bisa dengan menaruh proses utama di dalam gorutine tersebut, dan menaruh kode untuk deteksi di luar (di dalam handler-nya).</li><li>Cara ke-2: Atau sebaliknya. Menaruh proses utama di dalam handler, dan menempatkan deteksi cancelled request dalam goroutine baru.</li></ul><p>Pada contoh berikut, kita gunakan cara pertama. Tulis kode berikut dalam handler.</p><pre><code class="lang-go">done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>)
<span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
    <span class="hljs-comment">// do the process here</span>
    <span class="hljs-comment">// simulate a long-time request by putting 10 seconds sleep</span>
    time.Sleep(<span class="hljs-number">10</span> * time.Second)

    done &lt;- <span class="hljs-literal">true</span>
}()

<span class="hljs-keyword">select</span> {
<span class="hljs-keyword">case</span> &lt;-r.Context().Done():
    <span class="hljs-keyword">if</span> err := r.Context().Err(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">if</span> strings.Contains(strings.ToLower(err.Error()), <span class="hljs-string">&quot;canceled&quot;</span>) {
            log.Println(<span class="hljs-string">&quot;request canceled&quot;</span>)
        } <span class="hljs-keyword">else</span> {
            log.Println(<span class="hljs-string">&quot;unknown error occured.&quot;</span>, err.Error())
        }
    }
<span class="hljs-keyword">case</span> &lt;-done:
    log.Println(<span class="hljs-string">&quot;done&quot;</span>)
}
</code></pre><p>Pada kode di atas terlihat, proses utama dibungkus dalam goroutine. Ketika selesai, sebuah data dikirimkan ke channel <code>done</code>.</p><p>Lalu diluar, keyword <code>select</code> dipergunakan untuk deteksi pengiriman terhadap dua channel.</p><ul><li>Channel <code>r.Context().Done()</code>, jika channel ini menerima data maka diasumsikan request selesai. Selanjutnya lakukan pengecekan pada objek error milik konteks untuk deteksi apakah selesai-nya request ini karena memang selesai, atau di-cancel oleh client, atau faktor lainnya.</li><li>Channel <code>&lt;-done</code>, jika channel ini menerima data, maka proses utama adalah selesai.</li></ul><p>Jalankan kode lalu test hasilnya.</p><pre><code class="lang-bash">curl -X GET http://localhost:8080/
</code></pre><p><img alt="Cancelled client http request"src="images/B.23_1_cancelled_request_get.png"></p><p>Pada gambar di atas terdapat dua request, yg pertama sukses dan yang kedua adalah cancelled. Pesan <code>request cancelled</code> muncul ketika client http request dibatalkan.</p><blockquote><p>Di CMD/terminal bisa cukup dengan <code>ctrl + c</code> untuk cancel request</p></blockquote><h2 id="b322-handle-cancelled-request-yang-ada-payload-nya">B.32.2. Handle Cancelled Request yang ada Payload-nya</h2><p>Khusus untuk request dengan HTTP method yang mewajibkan untuk ada request body-nya (payload), maka channel <code>r.Context().Done()</code> tidak akan menerima data hingga terjadi proses read pada body payload.</p><pre><code class="lang-go"><span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
    <span class="hljs-comment">// do the process here</span>
    <span class="hljs-comment">// simulate a long-time request by putting 10 seconds sleep</span>

    body, err := ioutil.ReadAll(r.Body)
    <span class="hljs-comment">// ...</span>

    time.Sleep(<span class="hljs-number">10</span> * time.Second)

    done &lt;- <span class="hljs-literal">true</span>
}()
</code></pre><p>Jalankan ulang program kemudian test.</p><pre><code class="lang-go">curl -X POST http:<span class="hljs-comment">//localhost:8080/ -H &apos;Content-Type: application/json&apos; -d &apos;{}&apos;</span>
</code></pre><p><img alt="Cancelled client http request"src="images/B.23_2_cancelled request_with_payload.png"></p><hr><div class="source-code-link"><div class="source-code-link-message">Source code praktek pada bab ini tersedia di Github</div><a href="https://github.com/novalagung/dasarpemrogramangolang/tree/master/chapter-B.23-handle-cancelled-http-request"target="_blank">https://github.com/novalagung/dasarpemrogramangolang/.../chapter-B.23...</a></div></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title">results matching ""</h1></div><div class="no-results"><h1 class="search-results-title">No results matching ""</h1></div></div></div></div></div></div><a href="B-22-configuration-file.html"class="navigation navigation-prev navigation-unique"aria-label="Previous page: B.22. Configuration File"></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"B.23. Server Handler untuk Cancelled Client HTTP Request",level:"1.3.23",depth:2,next:{title:"C. Pemrograman Go Lanjut",level:"1.4",depth:1,ref:"",articles:[{title:"C.1. Echo Framework & Routing",level:"1.4.1",depth:2,path:"C-1-echo-routing.md",ref:"C-1-echo-routing.md",articles:[]},{title:"C.2. Parsing HTTP Request Payload (Echo)",level:"1.4.2",depth:2,path:"C-2-parsing-http-request-payload-echo.md",ref:"C-2-parsing-http-request-payload-echo.md",articles:[]},{title:"C.3. HTTP Request Payload Validation (Validator v9, Echo)",level:"1.4.3",depth:2,path:"C-3-http-request-payload-validation.md",ref:"C-3-http-request-payload-validation.md",articles:[]},{title:"C.4. HTTP Error Handling (Validator v9, Echo)",level:"1.4.4",depth:2,path:"C-4-http-error-handling.md",ref:"C-4-http-error-handling.md",articles:[]},{title:"C.5. Template Rendering in Echo",level:"1.4.5",depth:2,path:"C-5-echo-template-rendering.md",ref:"C-5-echo-template-rendering.md",articles:[]},{title:"C.6. Advanced Middleware & Logging (Logrus, Echo Logger)",level:"1.4.6",depth:2,path:"C-6-advanced-middleware-and-logging.md",ref:"C-6-advanced-middleware-and-logging.md",articles:[]},{title:"C.7. CLI Flag Parser (Kingpin)",level:"1.4.7",depth:2,path:"C-7-flag-parser.md",ref:"C-7-flag-parser.md",articles:[]},{title:"C.8. Advanced Configuration File (Viper)",level:"1.4.8",depth:2,path:"C-8-advanced-configuration-file.md",ref:"C-8-advanced-configuration-file.md",articles:[]},{title:"C.9. Secure Cookie (Gorilla Securecookie)",level:"1.4.9",depth:2,path:"C-9-securecookie.md",ref:"C-9-securecookie.md",articles:[]},{title:"C.10. Session (Gorilla Session)",level:"1.4.10",depth:2,path:"C-10-session.md",ref:"C-10-session.md",articles:[]},{title:"C.12. CORS & Preflight Request",level:"1.4.11",depth:2,path:"C-12-cors-preflight-request.md",ref:"C-12-cors-preflight-request.md",articles:[]},{title:"C.13. CSRF",level:"1.4.12",depth:2,path:"C-13-csrf.md",ref:"C-13-csrf.md",articles:[]},{title:"C.14. Secure Middleware",level:"1.4.13",depth:2,path:"C-14-secure-middleware.md",ref:"C-14-secure-middleware.md",articles:[]},{title:"C.15. HTTP Gzip Compression (gziphandler)",level:"1.4.14",depth:2,path:"C-15-http-gzip-compression.md",ref:"C-15-http-gzip-compression.md",articles:[]},{title:"C.16. Send Mail (net/smtp, Gomail v2)",level:"1.4.15",depth:2,path:"C-16-send-email.md",ref:"C-16-send-email.md",articles:[]},{title:"C.17. Read & Write Excel XLSX File (Excelize)",level:"1.4.16",depth:2,path:"C-17-read-write-excel-xlsx-file.md",ref:"C-17-read-write-excel-xlsx-file.md",articles:[]},{title:"C.18. Write PDF File (gofpdf)",level:"1.4.17",depth:2,path:"C-18-write-pdf-file.md",ref:"C-18-write-pdf-file.md",articles:[]},{title:"C.19. Convert HTML to PDF (go-wkhtmltopdf)",level:"1.4.18",depth:2,path:"C-19-convert-html-to-pdf.md",ref:"C-19-convert-html-to-pdf.md",articles:[]},{title:"C.20. Scraping & Parsing HTML (goquery)",level:"1.4.19",depth:2,path:"C-20-scraping-parsing-html.md",ref:"C-20-scraping-parsing-html.md",articles:[]},{title:"C.21. Parse & Generate XML (etree)",level:"1.4.20",depth:2,path:"C-21-xml-parser.md",ref:"C-21-xml-parser.md",articles:[]},{title:"C.22. HTTPS/TLS Web Server",level:"1.4.21",depth:2,path:"C-22-https-tls.md",ref:"C-22-https-tls.md",articles:[]},{title:"C.23. HTTP/2 & HTTP/2 Server Push",level:"1.4.22",depth:2,path:"C-23-http2-server-push.md",ref:"C-23-http2-server-push.md",articles:[]},{title:"C.24. Client HTTP Request",level:"1.4.23",depth:2,path:"C-24-client-http-request.md",ref:"C-24-client-http-request.md",articles:[]},{title:"C.25. Secure & Insecure Client HTTP Request",level:"1.4.24",depth:2,path:"C-25-secure-insecure-client-http-request.md",ref:"C-25-secure-insecure-client-http-request.md",articles:[]},{title:"C.26. FTP",level:"1.4.25",depth:2,path:"C-26-golang-ftp.md",ref:"C-26-golang-ftp.md",articles:[]},{title:"C.27. SSH & SFTP",level:"1.4.26",depth:2,path:"C-27-golang-ssh-sftp.md",ref:"C-27-golang-ssh-sftp.md",articles:[]},{title:"C.28. Web Socket: Chatting App",level:"1.4.27",depth:2,path:"C-28-golang-web-socket.md",ref:"C-28-golang-web-socket.md",articles:[]},{title:"C.29. Protobuf",level:"1.4.28",depth:2,path:"C-29-golang-protobuf-implementation.md",ref:"C-29-golang-protobuf-implementation.md",articles:[]},{title:"C.30. gRPC + Protobuf",level:"1.4.29",depth:2,path:"C-30-golang-grpc-protobuf.md",ref:"C-30-golang-grpc-protobuf.md",articles:[]},{title:"C.31. Context: Value, Timeout, & Cancellation",level:"1.4.30",depth:2,path:"C-31-golang-context.md",ref:"C-31-golang-context.md",articles:[]},{title:"C.32. JSON Web Token (JWT)",level:"1.4.31",depth:2,path:"C-32-golang-jwt.md",ref:"C-32-golang-jwt.md",articles:[]},{title:"C.33. LDAP Authentication",level:"1.4.32",depth:2,path:"C-33-golang-ldap-authentication.md",ref:"C-33-golang-ldap-authentication.md",articles:[]}]},previous:{title:"B.22. Configuration File",level:"1.3.22",depth:2,path:"B-22-configuration-file.md",ref:"B-22-configuration-file.md",articles:[]},dir:"ltr"},config:{plugins:["ga","html-minifier","disqus","meta","sitemap","scripts"],styles:{website:"styles/website.css"},pluginsConfig:{disqus:{useIdentifier:!1,shortName:"dasarpemrogramangolang"},meta:{content:"",data:[{name:"google-site-verification",content:"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{name:"og:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{name:"twitter:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],name:""},scripts:{files:[]},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!0,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},highlight:{},sitemap:{hostname:"https://dasarpemrogramangolang.novalagung.com/"},ga:{configuration:"auto",token:"UA-27602984-29"},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1}},theme:"default",lunr:{maxIndexSize:1e9},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},gitbook:"*"},file:{path:"B-23-server-handle-cancelled-http-request.md",mtime:"2019-07-29T08:31:25.468Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2019-07-29T08:35:13.592Z"},basePath:".",book:{language:""}})})</script></div><script src="gitbook/gitbook.js"></script><script src="gitbook/theme.js"></script><script src="gitbook/gitbook-plugin-ga/plugin.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="gitbook/gitbook-plugin-search/search-engine.js"></script><script src="gitbook/gitbook-plugin-search/search.js"></script><script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script></body></html>